{"version":3,"sources":["../src/module.js"],"names":["_","MetricsPanelCtrl","leaflet","leafletCSS","fontawesome","Builder","Presenter","Marker","Wrapper","options","attribution","reuseTiles","panelDefaults","baseLayer","markerTemplates","name","class","markerColor","size","anchor","iconColor","topLeft","bottomRight","EventsMapCtrl","$scope","$injector","events","on","onDataReceived","bind","onRender","onInitEditMode","defaults","panel","markerLayer","L","layerGroup","marker","builder","presenter","data","render","map","_initializeMap","invalidateSize","markers","call","scope","elem","attrs","ctrl","mapContainer","find","tileLayer","addTo","fitBounds","addEditorTab","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import _ from 'lodash'\nimport './module.css!'\nimport {MetricsPanelCtrl} from 'app/plugins/sdk'\nimport * as leaflet from './external/leaflet/leaflet'\nimport * as leafletCSS from './external/leaflet/leaflet.css!'\nimport * as fontawesome from './external/font-awesome-4.7.0/css/font-awesome.min.css!'\nimport {Builder} from './util/builder'\nimport {Presenter} from './util/presenter'\nimport {Marker} from './util/marker'\nimport {Wrapper} from './util/wrapper'\n\nconst options = {\n  attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\"' + \n               'target=\"blank\">OpenStreetMap</a>, &copy;' +\n               '<a href=\"http://stamen.com\" target=\"blank\">Stamen Design</a>',\n  reuseTiles: true\n}\n\nconst panelDefaults = {\n  baseLayer: 'http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png',\n  markerTemplates: [\n    { name: \"mso\", class:\"exclamation-triangle\", markerColor:\"red\", size: [30, 50], anchor: [15, 50], iconColor: \"white\" },\n    { name: \"session_drop\", class:\"tint\", markerColor:\"#15a310\", size: [30, 50], anchor: [15, 50], iconColor: \"white\" },\n    { name: \"call_spike\", class:\"phone\", markerColor:\"#199fff\", size: [30, 50], anchor: [15, 50], iconColor: \"white\"  },\n    { name: \"change\", class:\"wrench\", markerColor:\"#9822d8\", size: [30, 50], anchor: [15, 50], iconColor: \"white\" },\n    { name: \"engineer\", class:\"male\", markerColor:\"#ff59f9\", size: [30, 50], anchor: [15, 50], iconColor: \"white\" }\n  ],\n  topLeft: \"58.744384, -8.329295\",\n  bottomRight: \"49.983103, 1.719198\"\n}\n\nexport class EventsMapCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector)\n\n    this.events.on('data-received', this.onDataReceived.bind(this))\n    this.events.on('render', this.onRender.bind(this))\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this))\n    _.defaults(this.panel, panelDefaults)\n    \n    this.markerLayer = L.layerGroup([])\n    this.marker = new Marker(this.markerLayer)\n    this.builder = new Builder()\n    this.presenter = new Presenter(this.panel.markerTemplates)\n  }\n\n  onDataReceived (data) {\n    this.data = data\n    this.render()\n  }\n\n  onRender () {\n    if (!this.map) { this._initializeMap() } \n    else { this.map.invalidateSize() }\n\n    this.markers = this.builder.call(this.data)\n    this.presenter.call(this.markers)\n    this.marker.call(this.markers)\n  }\n\n  link (scope, elem, attrs, ctrl) {\n    this.mapContainer = elem.find('#map')[0]\n  }\n\n  _initializeMap () {\n    this.map = L.map(this.mapContainer)\n    L.tileLayer(this.panel.baseLayer, options).addTo(this.map)\n    this.markerLayer.addTo(this.map)\n    this.map.fitBounds([this.panel.topLeft, this.panel.bottomRight])\n  }\n  \n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/events-map-panel/editor.html');\n  }\n}\n\nEventsMapCtrl.templateUrl = 'module.html'\nexport { EventsMapCtrl as PanelCtrl }\n"]}